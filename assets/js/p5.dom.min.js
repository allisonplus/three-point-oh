!function(root,factory){"function"==typeof define&&define.amd?define("p5.dom",["p5"],function(p5){factory(p5)}):factory("object"==typeof exports?require("../p5"):root.p5)}(this,function(p5){function getContainer(p){var container=document;return"string"==typeof p&&"#"===p[0]?(p=p.slice(1),container=document.getElementById(p)||document):p instanceof p5.Element?container=p.elt:p instanceof HTMLElement&&(container=p),container}function wrapElement(elt){if("INPUT"===elt.tagName&&"checkbox"===elt.type){var converted=new p5.Element(elt);return converted.checked=function(){return 0===arguments.length?this.elt.checked:(arguments[0]?this.elt.checked=!0:this.elt.checked=!1,this)},converted}return"VIDEO"===elt.tagName||"AUDIO"===elt.tagName?new p5.MediaElement(elt):"SELECT"===elt.tagName?createSelect(new p5.Element(elt)):new p5.Element(elt)}function addElement(elt,pInst,media){var node=pInst._userNode?pInst._userNode:document.body;node.appendChild(elt);var c=media?new p5.MediaElement(elt):new p5.Element(elt);return pInst._elements.push(c),c}function createMedia(pInst,type,src,callback){var elt=document.createElement(type),src=src||"";"string"==typeof src&&(src=[src]);for(var i=0;i<src.length;i++){var source=document.createElement("source");source.src=src[i],elt.appendChild(source)}if("undefined"!=typeof callback){var callbackHandler=function(){callback(),elt.removeEventListener("canplaythrough",callbackHandler)};elt.addEventListener("canplaythrough",callbackHandler)}var c=addElement(elt,pInst,!0);return c.loadedmetadata=!1,elt.addEventListener("loadedmetadata",function(){c.width=elt.videoWidth,c.height=elt.videoHeight,0===c.elt.width&&(c.elt.width=elt.videoWidth),0===c.elt.height&&(c.elt.height=elt.videoHeight),c.loadedmetadata=!0}),c}p5.prototype.select=function(e,p){var res=null,container=getContainer(p);return"."===e[0]?(e=e.slice(1),res=container.getElementsByClassName(e),res=res.length?res[0]:null):"#"===e[0]?(e=e.slice(1),res=container.getElementById(e)):(res=container.getElementsByTagName(e),res=res.length?res[0]:null),res?wrapElement(res):null},p5.prototype.selectAll=function(e,p){var res,arr=[],container=getContainer(p);if("."===e[0]?(e=e.slice(1),res=container.getElementsByClassName(e)):res=container.getElementsByTagName(e),res)for(var j=0;j<res.length;j++){var obj=wrapElement(res[j]);arr.push(obj)}return arr},p5.prototype.removeElements=function(e){for(var i=0;i<this._elements.length;i++)this._elements[i].elt instanceof HTMLCanvasElement||this._elements[i].remove()};var tags=["div","p","span"];tags.forEach(function(tag){var method="create"+tag.charAt(0).toUpperCase()+tag.slice(1);p5.prototype[method]=function(html){var elt=document.createElement(tag);return elt.innerHTML=void 0===typeof html?"":html,addElement(elt,this)}}),p5.prototype.createImg=function(){var self,elt=document.createElement("img"),args=arguments,setAttrs=function(){self.width=elt.offsetWidth||elt.width,self.height=elt.offsetHeight||elt.height,args.length>1&&"function"==typeof args[1]?(self.fn=args[1],self.fn()):args.length>1&&"function"==typeof args[2]&&(self.fn=args[2],self.fn())};return elt.src=args[0],args.length>1&&"string"==typeof args[1]&&(elt.alt=args[1]),elt.onload=function(){setAttrs()},self=addElement(elt,this)},p5.prototype.createA=function(href,html,target){var elt=document.createElement("a");return elt.href=href,elt.innerHTML=html,target&&(elt.target=target),addElement(elt,this)},p5.prototype.createSlider=function(min,max,value,step){var elt=document.createElement("input");return elt.type="range",elt.min=min,elt.max=max,0===step?elt.step=1e-18:step&&(elt.step=step),"number"==typeof value&&(elt.value=value),addElement(elt,this)},p5.prototype.createButton=function(label,value){var elt=document.createElement("button");return elt.innerHTML=label,value&&(elt.value=value),addElement(elt,this)},p5.prototype.createCheckbox=function(){var elt=document.createElement("div"),checkbox=document.createElement("input");checkbox.type="checkbox",elt.appendChild(checkbox);var self=addElement(elt,this);if(self.checked=function(){var cb=self.elt.getElementsByTagName("input")[0];if(cb){if(0===arguments.length)return cb.checked;arguments[0]?cb.checked=!0:cb.checked=!1}return self},this.value=function(val){return self.value=val,this},arguments[0]){var ran=Math.random().toString(36).slice(2),label=document.createElement("label");checkbox.setAttribute("id",ran),label.htmlFor=ran,self.value(arguments[0]),label.appendChild(document.createTextNode(arguments[0])),elt.appendChild(label)}return arguments[1]&&(checkbox.checked=!0),self},p5.prototype.createSelect=function(){var elt,self,arg=arguments[0];return"object"==typeof arg&&"SELECT"===arg.elt.nodeName?(self=arg,elt=this.elt=arg.elt):(elt=document.createElement("select"),arg&&"boolean"==typeof arg&&elt.setAttribute("multiple","true"),self=addElement(elt,this)),self.option=function(name,value){for(var index,i=0;i<this.elt.length;i++)if(this.elt[i].innerHTML==name){index=i;break}if(void 0!==index)value===!1?this.elt.remove(index):this.elt[index].innerHTML==this.elt[index].value?this.elt[index].innerHTML=this.elt[index].value=value:this.elt[index].value=value;else{var opt=document.createElement("option");opt.innerHTML=name,arguments.length>1?opt.value=value:opt.value=name,elt.appendChild(opt)}},self.selected=function(value){var arr=[];if(arguments.length>0){for(var i=0;i<this.elt.length;i++)value.toString()===this.elt[i].value&&(this.elt.selectedIndex=i);return this}if(arg){for(var i=0;i<this.elt.selectedOptions.length;i++)arr.push(this.elt.selectedOptions[i].value);return arr}return this.elt.value},self},p5.prototype.createRadio=function(){var radios=document.querySelectorAll("input[type=radio]"),count=0;if(radios.length>1){var length=radios.length,prev=radios[0].name,current=radios[1].name;count=1;for(var i=1;i<length;i++)current=radios[i].name,prev!=current&&count++,prev=current}else 1==radios.length&&(count=1);var elt=document.createElement("div"),self=addElement(elt,this),times=-1;return self.option=function(name,value){var opt=document.createElement("input");if(opt.type="radio",opt.innerHTML=name,arguments.length>1?opt.value=value:opt.value=name,opt.setAttribute("name","defaultradio"+count),elt.appendChild(opt),name){times++;var label=(Math.random().toString(36).slice(2),document.createElement("label"));opt.setAttribute("id","defaultradio"+count+"-"+times),label.htmlFor="defaultradio"+count+"-"+times,label.appendChild(document.createTextNode(name)),elt.appendChild(label)}return opt},self.selected=function(){var length=this.elt.childNodes.length;if(1==arguments.length){for(var i=0;i<length;i+=2)this.elt.childNodes[i].value==arguments[0]&&(this.elt.childNodes[i].checked=!0);return this}for(var i=0;i<length;i+=2)if(1==this.elt.childNodes[i].checked)return this.elt.childNodes[i].value},self.value=function(){var length=this.elt.childNodes.length;if(1==arguments.length){for(var i=0;i<length;i+=2)this.elt.childNodes[i].value==arguments[0]&&(this.elt.childNodes[i].checked=!0);return this}for(var i=0;i<length;i+=2)if(1==this.elt.childNodes[i].checked)return this.elt.childNodes[i].value;return""},self},p5.prototype.createInput=function(value,type){var elt=document.createElement("input");return elt.type=type?type:"text",value&&(elt.value=value),addElement(elt,this)},p5.prototype.createFileInput=function(callback,multiple){function handleFileSelect(evt){function makeLoader(theFile){var p5file=new p5.File(theFile);return function(e){p5file.data=e.target.result,callback(p5file)}}for(var files=evt.target.files,i=0;i<files.length;i++){var f=files[i],reader=new FileReader;reader.onload=makeLoader(f),f.type.indexOf("text")>-1?reader.readAsText(f):reader.readAsDataURL(f)}}if(window.File&&window.FileReader&&window.FileList&&window.Blob){var elt=document.createElement("input");return elt.type="file",multiple&&(elt.multiple="multiple"),elt.addEventListener("change",handleFileSelect,!1),addElement(elt,this)}console.log("The File APIs are not fully supported in this browser. Cannot create element.")},p5.prototype.createVideo=function(src,callback){return createMedia(this,"video",src,callback)},p5.prototype.createAudio=function(src,callback){return createMedia(this,"audio",src,callback)},p5.prototype.VIDEO="video",p5.prototype.AUDIO="audio",navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,p5.prototype.createCapture=function(){for(var constraints,cb,useVideo=!0,useAudio=!0,i=0;i<arguments.length;i++)arguments[i]===p5.prototype.VIDEO?useAudio=!1:arguments[i]===p5.prototype.AUDIO?useVideo=!1:"object"==typeof arguments[i]?constraints=arguments[i]:"function"==typeof arguments[i]&&(cb=arguments[i]);if(!navigator.getUserMedia)throw"getUserMedia not supported in this browser";var elt=document.createElement("video");constraints||(constraints={video:useVideo,audio:useAudio}),navigator.getUserMedia(constraints,function(stream){elt.src=window.URL.createObjectURL(stream),cb&&cb(stream)},function(e){console.log(e)});var c=addElement(elt,this,!0);return c.loadedmetadata=!1,elt.addEventListener("loadedmetadata",function(){elt.play(),elt.width?(c.width=elt.videoWidth=elt.width,c.height=elt.videoHeight=elt.height):(c.width=c.elt.width=elt.videoWidth,c.height=c.elt.height=elt.videoHeight),c.loadedmetadata=!0}),c},p5.prototype.createElement=function(tag,content){var elt=document.createElement(tag);return"undefined"!=typeof content&&(elt.innerHTML=content),addElement(elt,this)},p5.Element.prototype.addClass=function(c){return this.elt.className?this.elt.className=this.elt.className+" "+c:this.elt.className=c,this},p5.Element.prototype.removeClass=function(c){var regex=new RegExp("(?:^|\\s)"+c+"(?!\\S)");return this.elt.className=this.elt.className.replace(regex,""),this.elt.className=this.elt.className.replace(/^\s+|\s+$/g,""),this},p5.Element.prototype.child=function(c){return"undefined"==typeof c?this.elt.childNodes:("string"==typeof c?("#"===c[0]&&(c=c.substring(1)),c=document.getElementById(c)):c instanceof p5.Element&&(c=c.elt),this.elt.appendChild(c),this)},p5.Element.prototype.center=function(align){var style=this.elt.style.display,hidden="none"===this.elt.style.display,parentHidden="none"===this.parent().style.display,pos={x:this.elt.offsetLeft,y:this.elt.offsetTop};hidden&&this.show(),this.elt.style.display="block",this.position(0,0),parentHidden&&(this.parent().style.display="block");var wOffset=Math.abs(this.parent().offsetWidth-this.elt.offsetWidth),hOffset=Math.abs(this.parent().offsetHeight-this.elt.offsetHeight),y=pos.y,x=pos.x;return"both"===align||void 0===align?this.position(wOffset/2,hOffset/2):"horizontal"===align?this.position(wOffset/2,y):"vertical"===align&&this.position(x,hOffset/2),this.style("display",style),hidden&&this.hide(),parentHidden&&(this.parent().style.display="none"),this},p5.Element.prototype.html=function(){return 0===arguments.length?this.elt.innerHTML:arguments[1]?(this.elt.innerHTML+=arguments[0],this):(this.elt.innerHTML=arguments[0],this)},p5.Element.prototype.position=function(){return 0===arguments.length?{x:this.elt.offsetLeft,y:this.elt.offsetTop}:(this.elt.style.position="absolute",this.elt.style.left=arguments[0]+"px",this.elt.style.top=arguments[1]+"px",this.x=arguments[0],this.y=arguments[1],this)},p5.Element.prototype._translate=function(){this.elt.style.position="absolute";var transform="";return this.elt.style.transform&&(transform=this.elt.style.transform.replace(/translate3d\(.*\)/g,""),transform=transform.replace(/translate[X-Z]?\(.*\)/g,"")),2===arguments.length?this.elt.style.transform="translate("+arguments[0]+"px, "+arguments[1]+"px)":arguments.length>2&&(this.elt.style.transform="translate3d("+arguments[0]+"px,"+arguments[1]+"px,"+arguments[2]+"px)",3===arguments.length?this.elt.parentElement.style.perspective="1000px":this.elt.parentElement.style.perspective=arguments[3]+"px"),this.elt.style.transform+=transform,this},p5.Element.prototype._rotate=function(){var transform="";if(this.elt.style.transform){var transform=this.elt.style.transform.replace(/rotate3d\(.*\)/g,"");transform=transform.replace(/rotate[X-Z]?\(.*\)/g,"")}return 1===arguments.length?this.elt.style.transform="rotate("+arguments[0]+"deg)":2===arguments.length?this.elt.style.transform="rotate("+arguments[0]+"deg, "+arguments[1]+"deg)":3===arguments.length&&(this.elt.style.transform="rotateX("+arguments[0]+"deg)",this.elt.style.transform+="rotateY("+arguments[1]+"deg)",this.elt.style.transform+="rotateZ("+arguments[2]+"deg)"),this.elt.style.transform+=transform,this},p5.Element.prototype.style=function(prop,val){var self=this;if(val instanceof p5.Color&&(val="rgba("+val.levels[0]+","+val.levels[1]+","+val.levels[2]+","+val.levels[3]/255+")"),"undefined"==typeof val){if(prop.indexOf(":")===-1){var styles=window.getComputedStyle(self.elt),style=styles.getPropertyValue(prop);return style}for(var attrs=prop.split(";"),i=0;i<attrs.length;i++){var parts=attrs[i].split(":");parts[0]&&parts[1]&&(this.elt.style[parts[0].trim()]=parts[1].trim())}}else if("rotate"===prop||"translate"===prop||"position"===prop){var trans=Array.prototype.shift.apply(arguments),f=this[trans]||this["_"+trans];f.apply(this,arguments)}else if(this.elt.style[prop]=val,"width"===prop||"height"===prop||"left"===prop||"top"===prop){var numVal=val.replace(/\D+/g,"");this[prop]=parseInt(numVal,10)}return this},p5.Element.prototype.attribute=function(attr,value){if(null==this.elt.firstChild||"checkbox"!==this.elt.firstChild.type&&"radio"!==this.elt.firstChild.type)return"undefined"==typeof value?this.elt.getAttribute(attr):(this.elt.setAttribute(attr,value),this);if("undefined"==typeof value)return this.elt.firstChild.getAttribute(attr);for(var i=0;i<this.elt.childNodes.length;i++)this.elt.childNodes[i].setAttribute(attr,value)},p5.Element.prototype.removeAttribute=function(attr){if(null!=this.elt.firstChild&&("checkbox"===this.elt.firstChild.type||"radio"===this.elt.firstChild.type))for(var i=0;i<this.elt.childNodes.length;i++)this.elt.childNodes[i].removeAttribute(attr);return this.elt.removeAttribute(attr),this},p5.Element.prototype.value=function(){return arguments.length>0?(this.elt.value=arguments[0],this):"range"===this.elt.type?parseFloat(this.elt.value):this.elt.value},p5.Element.prototype.show=function(){return this.elt.style.display="block",this},p5.Element.prototype.hide=function(){return this.elt.style.display="none",this},p5.Element.prototype.size=function(w,h){if(0===arguments.length)return{width:this.elt.offsetWidth,height:this.elt.offsetHeight};var aW=w,aH=h,AUTO=p5.prototype.AUTO;if(aW!==AUTO||aH!==AUTO){if(aW===AUTO?aW=h*this.width/this.height:aH===AUTO&&(aH=w*this.height/this.width),this.elt instanceof HTMLCanvasElement){var j={},k=this.elt.getContext("2d");for(var prop in k)j[prop]=k[prop];this.elt.setAttribute("width",aW*this._pInst._pixelDensity),this.elt.setAttribute("height",aH*this._pInst._pixelDensity),this.elt.setAttribute("style","width:"+aW+"px; height:"+aH+"px"),this._pInst.scale(this._pInst._pixelDensity,this._pInst._pixelDensity);for(var prop in j)this.elt.getContext("2d")[prop]=j[prop]}else this.elt.style.width=aW+"px",this.elt.style.height=aH+"px",this.elt.width=aW,this.elt.height=aH,this.width=aW,this.height=aH;this.width=this.elt.offsetWidth,this.height=this.elt.offsetHeight,this._pInst&&this._pInst._curElement.elt===this.elt&&(this._pInst._setProperty("width",this.elt.offsetWidth),this._pInst._setProperty("height",this.elt.offsetHeight))}return this},p5.Element.prototype.remove=function(){for(var ev in this._events)this.elt.removeEventListener(ev,this._events[ev]);this.elt.parentNode&&this.elt.parentNode.removeChild(this.elt),delete this},p5.MediaElement=function(elt,pInst){p5.Element.call(this,elt,pInst);var self=this;this.elt.crossOrigin="anonymous",this._prevTime=0,this._cueIDCounter=0,this._cues=[],this._pixelDensity=1,Object.defineProperty(self,"src",{get:function(){var firstChildSrc=self.elt.children[0].src,srcVal=self.elt.src===window.location.href?"":self.elt.src,ret=firstChildSrc===window.location.href?srcVal:firstChildSrc;return ret},set:function(newValue){for(var i=0;i<self.elt.children.length;i++)self.elt.removeChild(self.elt.children[i]);var source=document.createElement("source");source.src=newValue,elt.appendChild(source),self.elt.src=newValue}}),self._onended=function(){},self.elt.onended=function(){self._onended(self)}},p5.MediaElement.prototype=Object.create(p5.Element.prototype),p5.MediaElement.prototype.play=function(){return this.elt.currentTime===this.elt.duration&&(this.elt.currentTime=0),this.elt.readyState>1?this.elt.play():(this.elt.load(),this.elt.play()),this},p5.MediaElement.prototype.stop=function(){return this.elt.pause(),this.elt.currentTime=0,this},p5.MediaElement.prototype.pause=function(){return this.elt.pause(),this},p5.MediaElement.prototype.loop=function(){return this.elt.setAttribute("loop",!0),this.play(),this},p5.MediaElement.prototype.noLoop=function(){return this.elt.setAttribute("loop",!1),this},p5.MediaElement.prototype.autoplay=function(val){return this.elt.setAttribute("autoplay",val),this},p5.MediaElement.prototype.volume=function(val){return"undefined"==typeof val?this.elt.volume:void(this.elt.volume=val)},p5.MediaElement.prototype.speed=function(val){return"undefined"==typeof val?this.elt.playbackRate:void(this.elt.playbackRate=val)},p5.MediaElement.prototype.time=function(val){return"undefined"==typeof val?this.elt.currentTime:void(this.elt.currentTime=val)},p5.MediaElement.prototype.duration=function(){return this.elt.duration},p5.MediaElement.prototype.pixels=[],p5.MediaElement.prototype.loadPixels=function(){return this.canvas||(this.canvas=document.createElement("canvas"),this.drawingContext=this.canvas.getContext("2d")),this.loadedmetadata&&(this.canvas.width!==this.elt.width&&(this.canvas.width=this.elt.width,this.canvas.height=this.elt.height,this.width=this.canvas.width,this.height=this.canvas.height),this.drawingContext.drawImage(this.elt,0,0,this.canvas.width,this.canvas.height),p5.Renderer2D.prototype.loadPixels.call(this)),this},p5.MediaElement.prototype.updatePixels=function(x,y,w,h){return this.loadedmetadata&&p5.Renderer2D.prototype.updatePixels.call(this,x,y,w,h),this},p5.MediaElement.prototype.get=function(x,y,w,h){return this.loadedmetadata?p5.Renderer2D.prototype.get.call(this,x,y,w,h):"undefined"==typeof x?new p5.Image(1,1):w>1?new p5.Image(x,y,w,h):[0,0,0,255]},p5.MediaElement.prototype.set=function(x,y,imgOrCol){this.loadedmetadata&&p5.Renderer2D.prototype.set.call(this,x,y,imgOrCol)},p5.MediaElement.prototype.copy=function(){p5.Renderer2D.prototype.copy.apply(this,arguments)},p5.MediaElement.prototype.mask=function(){this.loadPixels(),p5.Image.prototype.mask.apply(this,arguments)},p5.MediaElement.prototype.onended=function(callback){return this._onended=callback,this},p5.MediaElement.prototype.connect=function(obj){var audioContext,masterOutput;if("function"==typeof p5.prototype.getAudioContext)audioContext=p5.prototype.getAudioContext(),masterOutput=p5.soundOut.input;else try{audioContext=obj.context,masterOutput=audioContext.destination}catch(e){throw"connect() is meant to be used with Web Audio API or p5.sound.js"}this.audioSourceNode||(this.audioSourceNode=audioContext.createMediaElementSource(this.elt),this.audioSourceNode.connect(masterOutput)),obj?obj.input?this.audioSourceNode.connect(obj.input):this.audioSourceNode.connect(obj):this.audioSourceNode.connect(masterOutput)},p5.MediaElement.prototype.disconnect=function(){if(!this.audioSourceNode)throw"nothing to disconnect";this.audioSourceNode.disconnect()},p5.MediaElement.prototype.showControls=function(){this.elt.style["text-align"]="inherit",this.elt.controls=!0},p5.MediaElement.prototype.hideControls=function(){this.elt.controls=!1},p5.MediaElement.prototype.addCue=function(time,callback,val){var id=this._cueIDCounter++,cue=new Cue(callback,time,id,val);return this._cues.push(cue),this.elt.ontimeupdate||(this.elt.ontimeupdate=this._onTimeUpdate.bind(this)),id},p5.MediaElement.prototype.removeCue=function(id){for(var i=0;i<this._cues.length;i++)this._cues[i]===id&&(console.log(id),this._cues.splice(i,1));0===this._cues.length&&(this.elt.ontimeupdate=null)},p5.MediaElement.prototype.clearCues=function(){this._cues=[],this.elt.ontimeupdate=null},p5.MediaElement.prototype._onTimeUpdate=function(){for(var playbackTime=this.time(),i=0;i<this._cues.length;i++){var callbackTime=this._cues[i].time,val=this._cues[i].val;this._prevTime<callbackTime&&callbackTime<=playbackTime&&this._cues[i].callback(val)}this._prevTime=playbackTime};var Cue=function(callback,time,id,val){this.callback=callback,this.time=time,this.id=id,this.val=val};p5.File=function(file,pInst){this.file=file,this._pInst=pInst;var typeList=file.type.split("/");this.type=typeList[0],this.subtype=typeList[1],this.name=file.name,this.size=file.size,this.data=void 0}});